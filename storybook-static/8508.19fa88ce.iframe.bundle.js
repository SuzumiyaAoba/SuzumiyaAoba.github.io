"use strict";(self.webpackChunksuzumiyaaoba_github_io=self.webpackChunksuzumiyaaoba_github_io||[]).push([[8508],{"./src/components/VisDotGraph/index.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.d(__webpack_exports__,{k:()=>VisDotGraph});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),src=__webpack_require__("./node_modules/d3/src/index.js"),katex=(__webpack_require__("./node_modules/katex/dist/katex.min.css"),__webpack_require__("./node_modules/katex/dist/katex.mjs")),console=__webpack_require__("./node_modules/console-browserify/index.js");const renderMath=text=>{try{return text.replace(/\$([^$]+)\$/g,((match,math)=>{try{return katex.Ay.renderToString(math,{throwOnError:!1,displayMode:!1,strict:!1})}catch(error){return console.warn("KaTeX rendering error:",error),match}}))}catch(error){return console.warn("Math rendering error:",error),text}},D3Graph=({data,width="100%",height="400px",className="",fontSize=12})=>{const containerRef=(0,react.useRef)(null),[isClient,setIsClient]=(0,react.useState)(!1),[error,setError]=(0,react.useState)(null),isMountedRef=(0,react.useRef)(!0);(0,react.useEffect)((()=>(isMountedRef.current=!0,()=>{isMountedRef.current=!1})),[]);const parsedData=(0,react.useMemo)((()=>{try{if(!data)throw new Error("データが提供されていません");const nodes=data.nodes.map((node=>({id:node.id,label:node.label,state:node.state,shape:node.shape||"circle",color:node.color||"#97C2FC",size:node.size||8}))),edges=data.edges.map((edge=>({source:edge.from||edge.source||"",target:edge.to||edge.target||"",from:edge.from||edge.source||"",to:edge.to||edge.target||"",label:edge.label||"",color:edge.color||"#2B7CE9",style:edge.style||"solid",width:edge.width||2})));return{nodes,edges}}catch(err){return setError(err instanceof Error?err.message:String(err)),{nodes:[],edges:[]}}}),[data]),isTree=(0,react.useMemo)((()=>function isTreeStructure(nodes,edges){if(0===nodes.length)return!1;const inDegree=new Map;nodes.forEach((node=>inDegree.set(node.id,0))),edges.forEach((edge=>{var _edge_target,_edge_to;const target="string"==typeof edge.target?edge.target:"string"==typeof edge.to?edge.to:(null===(_edge_target=edge.target)||void 0===_edge_target?void 0:_edge_target.id)||(null===(_edge_to=edge.to)||void 0===_edge_to?void 0:_edge_to.id);target&&inDegree.set(target,(inDegree.get(target)||0)+1)}));const roots=Array.from(inDegree.entries()).filter((([_,degree])=>0===degree));if(1!==roots.length)return!1;const visited=new Set,queue=[roots[0][0]];for(;queue.length>0;){const current=queue.shift();visited.has(current)||(visited.add(current),edges.forEach((edge=>{var _edge_source,_edge_from,_edge_target,_edge_to;const source="string"==typeof edge.source?edge.source:"string"==typeof edge.from?edge.from:(null===(_edge_source=edge.source)||void 0===_edge_source?void 0:_edge_source.id)||(null===(_edge_from=edge.from)||void 0===_edge_from?void 0:_edge_from.id),target="string"==typeof edge.target?edge.target:"string"==typeof edge.to?edge.to:(null===(_edge_target=edge.target)||void 0===_edge_target?void 0:_edge_target.id)||(null===(_edge_to=edge.to)||void 0===_edge_to?void 0:_edge_to.id);source===current&&target&&!visited.has(target)&&queue.push(target)})))}return visited.size===nodes.length}(parsedData.nodes,parsedData.edges)),[parsedData]),hierarchy=(0,react.useMemo)((()=>isTree?function createHierarchy(nodes,edges){var _Array_from_find;if(0===nodes.length)return null;const inDegree=new Map;nodes.forEach((node=>inDegree.set(node.id,0))),edges.forEach((edge=>{var _edge_target,_edge_to;const target="string"==typeof edge.target?edge.target:"string"==typeof edge.to?edge.to:(null===(_edge_target=edge.target)||void 0===_edge_target?void 0:_edge_target.id)||(null===(_edge_to=edge.to)||void 0===_edge_to?void 0:_edge_to.id);target&&inDegree.set(target,(inDegree.get(target)||0)+1)}));const rootId=null===(_Array_from_find=Array.from(inDegree.entries()).find((([_,degree])=>0===degree)))||void 0===_Array_from_find?void 0:_Array_from_find[0];if(!rootId)return null;const nodeMap=new Map;return nodes.forEach((node=>{nodeMap.set(node.id,{...node,children:[]})})),edges.forEach((edge=>{var _edge_source,_edge_from,_edge_target,_edge_to;const source="string"==typeof edge.source?edge.source:"string"==typeof edge.from?edge.from:(null===(_edge_source=edge.source)||void 0===_edge_source?void 0:_edge_source.id)||(null===(_edge_from=edge.from)||void 0===_edge_from?void 0:_edge_from.id),target="string"==typeof edge.target?edge.target:"string"==typeof edge.to?edge.to:(null===(_edge_target=edge.target)||void 0===_edge_target?void 0:_edge_target.id)||(null===(_edge_to=edge.to)||void 0===_edge_to?void 0:_edge_to.id);if(source&&target){const parent=nodeMap.get(source),child=nodeMap.get(target);parent&&child&&parent.children.push(child)}})),src.Sk5(nodeMap.get(rootId))}(parsedData.nodes,parsedData.edges):null),[parsedData,isTree]),renderGraph=(0,react.useCallback)((()=>{if(containerRef.current&&isClient&&isMountedRef.current)try{if(src.Ltv(containerRef.current).selectAll("*").remove(),0===parsedData.nodes.length)return;const container=containerRef.current,containerRect=container.getBoundingClientRect(),graphWidth=containerRect.width,graphHeight=containerRect.height,svg=src.Ltv(container).append("svg").attr("width",graphWidth).attr("height",graphHeight);isTree&&hierarchy?renderTreeLayout(svg,hierarchy,graphWidth,graphHeight):renderForceLayout(svg,parsedData,graphWidth,graphHeight)}catch(err){if(isMountedRef.current){const errorMessage=err instanceof Error?err.message:String(err);setError(`グラフ描画エラー: ${errorMessage}`)}}}),[parsedData,isTree,hierarchy,isClient,fontSize]),renderTreeLayout=(0,react.useCallback)(((svg,hierarchy,width,height)=>{const root=src.B22().size([width-100,height-100]).separation(((a,b)=>(a.parent===b.parent?1:1.2)/2))(hierarchy),nodeGroups=(svg.append("g").attr("transform","translate(50,50)").selectAll("line").data(root.links()).enter().append("line").attr("x1",(d=>d.source.x)).attr("y1",(d=>d.source.y+20)).attr("x2",(d=>d.target.x)).attr("y2",(d=>d.target.y-20)).attr("stroke","#2B7CE9").attr("stroke-width",2).attr("fill","none"),svg.append("g").attr("transform","translate(50,50)").selectAll("g").data(root.descendants()).enter().append("g").attr("transform",(d=>`translate(${d.x},${d.y})`)));nodeGroups.append("circle").attr("r",(d=>d.data.size||8)).attr("fill",(d=>d.data.color||"#97C2FC")).attr("stroke","#fff").attr("stroke-width",2).style("opacity",0),nodeGroups.append("foreignObject").attr("width",120).attr("height",40).attr("x",-60).attr("y",-20).append("xhtml:div").style("text-align","center").style("font-size",`${fontSize}px`).style("font-weight","bold").style("color","#333").style("pointer-events","none").style("display","flex").style("align-items","center").style("justify-content","center").style("height","100%").each((function(d){const div=src.Ltv(this),label=d.data.label,state=d.data.state,displayText=state?`${state} (${label})`:`(${label})`;try{const renderedText=renderMath(displayText);div.html(renderedText)}catch(error){console.error("KaTeX rendering error:",error),div.text(displayText)}}))}),[fontSize]),renderForceLayout=(0,react.useCallback)(((svg,data,width,height)=>{const simulation=src.tXi(data.nodes).force("link",src.kJC(data.edges).id((d=>d.id)).distance(100)).force("charge",src.xJS().strength(-300)).force("center",src.jTM(width/2,height/2)),links=svg.append("g").selectAll("line").data(data.edges).enter().append("line").attr("stroke",(d=>d.color||"#2B7CE9")).attr("stroke-width",(d=>d.width||2)).attr("fill","none"),nodeGroups=svg.append("g").selectAll("g").data(data.nodes).enter().append("g").call(src.$Er().on("start",(function dragstarted(event,d){event.active||simulation.alphaTarget(.3).restart();d.fx=d.x,d.fy=d.y})).on("drag",(function dragged(event,d){d.fx=event.x,d.fy=event.y})).on("end",(function dragended(event,d){event.active||simulation.alphaTarget(0);d.fx=null,d.fy=null})));nodeGroups.append("circle").attr("r",(d=>d.size||8)).attr("fill",(d=>d.color||"#97C2FC")).attr("stroke","#fff").attr("stroke-width",2),nodeGroups.append("foreignObject").attr("width",120).attr("height",40).attr("x",-60).attr("y",-20).append("xhtml:div").style("text-align","center").style("font-size",`${fontSize}px`).style("font-weight","bold").style("color","#333").style("pointer-events","none").style("display","flex").style("align-items","center").style("justify-content","center").style("height","100%").each((function(d){const div=src.Ltv(this),label=d.label,state=d.state,displayText=state?`${state} (${label})`:`(${label})`;try{const renderedText=renderMath(displayText);div.html(renderedText)}catch(error){console.error("KaTeX rendering error:",error),div.text(displayText)}}));simulation.on("tick",(()=>{links.attr("x1",(d=>d.source.x)).attr("y1",(d=>d.source.y+20)).attr("x2",(d=>d.target.x)).attr("y2",(d=>d.target.y-20)),nodeGroups.attr("transform",(d=>`translate(${d.x},${d.y})`))})),isMountedRef.current&&(containerRef.current.__simulation=simulation)}),[fontSize]);(0,react.useEffect)((()=>{setIsClient(!0)}),[]),(0,react.useEffect)((()=>{if(isClient&&isMountedRef.current){const timer=setTimeout((()=>{isMountedRef.current&&renderGraph()}),100);return()=>clearTimeout(timer)}}),[renderGraph,isClient]),(0,react.useEffect)((()=>()=>{isMountedRef.current=!1,containerRef.current&&containerRef.current.__simulation&&containerRef.current.__simulation.stop()}),[]);const ErrorDisplay=({message})=>(0,jsx_runtime.jsxs)("div",{role:"alert","aria-live":"polite",style:{color:"#dc2626",padding:"20px",border:"1px solid #fecaca",borderRadius:"8px",backgroundColor:"#fef2f2",fontFamily:"monospace",fontSize:"14px"},children:[(0,jsx_runtime.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:"エラー:"}),(0,jsx_runtime.jsx)("div",{children:message}),(0,jsx_runtime.jsx)("div",{style:{marginTop:"12px",fontSize:"12px",color:"#6b7280"},children:"有効なデータを入力してください。"})]});return(0,jsx_runtime.jsx)("div",{ref:containerRef,style:{width,height,position:"relative"},className,role:"region","aria-label":"グラフ表示エリア",children:error&&(0,jsx_runtime.jsx)(ErrorDisplay,{message:error})})};D3Graph.__docgenInfo={description:"",methods:[],displayName:"D3Graph",props:{data:{required:!0,tsType:{name:"signature",type:"object",raw:"{\n  nodes: TreeNode[];\n  edges: Array<{\n    from?: string;\n    to?: string;\n    source?: string;\n    target?: string;\n    label?: string;\n    color?: string;\n    style?: string;\n    width?: number;\n  }>;\n}",signature:{properties:[{key:"nodes",value:{name:"Array",elements:[{name:"TreeNode"}],raw:"TreeNode[]",required:!0}},{key:"edges",value:{name:"Array",elements:[{name:"signature",type:"object",raw:"{\n  from?: string;\n  to?: string;\n  source?: string;\n  target?: string;\n  label?: string;\n  color?: string;\n  style?: string;\n  width?: number;\n}",signature:{properties:[{key:"from",value:{name:"string",required:!1}},{key:"to",value:{name:"string",required:!1}},{key:"source",value:{name:"string",required:!1}},{key:"target",value:{name:"string",required:!1}},{key:"label",value:{name:"string",required:!1}},{key:"color",value:{name:"string",required:!1}},{key:"style",value:{name:"string",required:!1}},{key:"width",value:{name:"number",required:!1}}]}}],raw:"Array<{\n  from?: string;\n  to?: string;\n  source?: string;\n  target?: string;\n  label?: string;\n  color?: string;\n  style?: string;\n  width?: number;\n}>",required:!0}}]}},description:""},width:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'100%'",computed:!1}},height:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'400px'",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},fontSize:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"12",computed:!1}}}};const VisDotGraph=({data,width="100%",height="400px",className="",fontSize=14})=>{const[error,setError]=(0,react.useState)(null),normalizedData=(0,react.useMemo)((()=>{try{if(!data)throw new Error("データが提供されていません");if("id"in data&&"label"in data&&!("nodes"in data)){return{nodes:flattenTree(data),edges:[]}}if("nodes"in data){const graphData=data;return{nodes:graphData.nodes,edges:graphData.edges||[]}}throw new Error("無効なデータ形式です")}catch(err){return setError(err instanceof Error?err.message:String(err)),{nodes:[],edges:[]}}}),[data]),flattenTree=node=>{const result=[node];return node.children&&node.children.forEach((child=>{result.push(...flattenTree(child))})),result},generateEdges=node=>{const edges=[];return node.children&&node.children.forEach((child=>{edges.push({from:node.id,to:child.id,label:child.state||""}),edges.push(...generateEdges(child))})),edges},finalData=(0,react.useMemo)((()=>{if(!data)return{nodes:[],edges:[]};if("id"in data&&"label"in data&&!("nodes"in data)){const rootNode=data;return{nodes:normalizedData.nodes,edges:generateEdges(rootNode)}}return normalizedData}),[data,normalizedData]);return error?(0,jsx_runtime.jsx)("div",{style:{width,height,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"#f9fafb",color:"#6b7280",fontFamily:"monospace",fontSize:fontSize.toString()+"px"},className,role:"region","aria-label":"グラフ表示エリア",children:(0,jsx_runtime.jsxs)("div",{style:{textAlign:"center"},children:[(0,jsx_runtime.jsx)("div",{style:{fontWeight:"bold",marginBottom:"8px"},children:"エラー:"}),(0,jsx_runtime.jsx)("div",{children:error}),(0,jsx_runtime.jsxs)("div",{style:{marginTop:"12px",fontSize:"12px"},children:["データ: ",JSON.stringify(data,null,2)]})]})}):0===finalData.nodes.length?(0,jsx_runtime.jsx)("div",{style:{width,height,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #e5e7eb",borderRadius:"8px",backgroundColor:"#f9fafb",color:"#6b7280",fontFamily:"monospace",fontSize:fontSize.toString()+"px"},className,role:"region","aria-label":"グラフ表示エリア",children:"データがありません"}):(0,jsx_runtime.jsx)(D3Graph,{data:finalData,width,height,className,fontSize})};VisDotGraph.__docgenInfo={description:"",methods:[],displayName:"VisDotGraph",props:{data:{required:!0,tsType:{name:"union",raw:"GraphData | TreeNode",elements:[{name:"GraphData"},{name:"TreeNode"}]},description:""},width:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'100%'",computed:!1}},height:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"'400px'",computed:!1}},className:{required:!1,tsType:{name:"string"},description:"",defaultValue:{value:"''",computed:!1}},fontSize:{required:!1,tsType:{name:"number"},description:"",defaultValue:{value:"14",computed:!1}}}}}}]);