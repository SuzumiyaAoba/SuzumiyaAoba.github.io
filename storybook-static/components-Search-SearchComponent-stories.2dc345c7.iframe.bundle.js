"use strict";(self.webpackChunksuzumiyaaoba_github_io=self.webpackChunksuzumiyaaoba_github_io||[]).push([[9134],{"./src/components/Search/SearchComponent.stories.tsx":(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{Default:()=>Default,__namedExportsOrder:()=>__namedExportsOrder,default:()=>SearchComponent_stories});var jsx_runtime=__webpack_require__("./node_modules/next/dist/compiled/react/jsx-runtime.js"),react=__webpack_require__("./node_modules/next/dist/compiled/react/index.js"),navigation=__webpack_require__("./node_modules/@storybook/nextjs/dist/export-mocks/navigation/index.mjs"),external=__webpack_require__("./node_modules/zod/v4/classic/external.js"),console=__webpack_require__("./node_modules/console-browserify/index.js");const pagefindResultSchema=external.Ikc({url:external.YjP(),excerpt:external.YjP(),meta:external.Ikc({title:external.YjP().optional()})});function SearchComponent(){const router=(0,navigation.useRouter)(),searchParams=(0,navigation.useSearchParams)(),initialQuery=(null==searchParams?void 0:searchParams.get("q"))||"",[query,setQuery]=(0,react.useState)(initialQuery),[results,setResults]=(0,react.useState)([]),[isLoading,setIsLoading]=(0,react.useState)(!1),[pagefindError,setPagefindError]=(0,react.useState)(null),[pagefindLoaded,setPagefindLoaded]=(0,react.useState)(!1),timerRef=(0,react.useRef)(null),performSearch=(0,react.useCallback)((async searchQuery=>{if(searchQuery.trim())if(window.pagefind&&window.__pagefind_loaded){setIsLoading(!0);try{console.log("Executing search:",searchQuery);const search=await window.pagefind.search(searchQuery);if(!search||!search.results)return console.log("No search results or search object is invalid"),setResults([]),void setIsLoading(!1);const searchResults=await Promise.all(search.results.map((async result=>await result.data()))),validResults=external.YOg(pagefindResultSchema).parse(searchResults);setResults(validResults)}catch(error){console.error("Search failed:",error),setResults([]),setPagefindError("検索中にエラーが発生しました。")}finally{setIsLoading(!1)}}else setPagefindError("検索エンジンがロードされていません。しばらく待つか、ページを更新してください。");else setResults([])}),[]);(0,react.useEffect)((()=>{function handlePagefindInitialized(){console.log("Pagefind initialized event received"),setPagefindLoaded(!0),setPagefindError(null),initialQuery&&performSearch(initialQuery)}function handlePagefindError(event){var _event_detail;console.error("Pagefind error event received:",event.detail),setPagefindError(`検索エンジンの読み込みに失敗しました: ${(null===(_event_detail=event.detail)||void 0===_event_detail?void 0:_event_detail.error)||"不明なエラー"}`)}if(window.__pagefind_loaded)return console.log("Pagefind already loaded"),setPagefindLoaded(!0),setPagefindError(null),void(initialQuery&&performSearch(initialQuery));window.addEventListener("pagefind:initialized",handlePagefindInitialized),window.addEventListener("pagefind:error",handlePagefindError);const timeoutId=setTimeout((()=>{window.__pagefind_loaded||window.__pagefind_loading||(console.error("Pagefind loading timeout"),setPagefindError("検索エンジンの読み込みがタイムアウトしました。ページを更新してください。"))}),1e4);return()=>{window.removeEventListener("pagefind:initialized",handlePagefindInitialized),window.removeEventListener("pagefind:error",handlePagefindError),clearTimeout(timeoutId)}}),[initialQuery,performSearch]);return(0,jsx_runtime.jsxs)("div",{className:"w-full",children:[(0,jsx_runtime.jsx)("div",{className:"mb-6",children:(0,jsx_runtime.jsx)("div",{className:"flex gap-2",children:(0,jsx_runtime.jsx)("input",{type:"text",value:query,onChange:e=>{const newQuery=e.target.value;setQuery(newQuery),timerRef.current&&clearTimeout(timerRef.current),timerRef.current=setTimeout((()=>{const params=new URLSearchParams((null==searchParams?void 0:searchParams.toString())||"");newQuery?params.set("q",newQuery):params.delete("q"),router.push(`/search?${params.toString()}`,{scroll:!1}),performSearch(newQuery)}),300)},placeholder:"検索キーワードを入力...",className:"flex-1 p-2 border rounded-md",style:{color:"var(--foreground)",backgroundColor:"var(--input-bg)"},"aria-label":"検索",disabled:!!pagefindError||!pagefindLoaded})})}),pagefindError&&(0,jsx_runtime.jsxs)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-md p-4 mb-6",children:[(0,jsx_runtime.jsx)("p",{className:"text-yellow-800 mb-2",children:pagefindError}),(0,jsx_runtime.jsx)("button",{onClick:()=>{alert("開発環境でPagefindを使用するには、以下のコマンドを実行してください：\n\nnpm run build\nnpm run pagefind:dev\nnpm run dev")},className:"text-blue-600 hover:underline",children:"開発環境用セットアップ手順を表示"})]}),pagefindLoaded||pagefindError?isLoading?(0,jsx_runtime.jsx)("div",{className:"py-4",children:(0,jsx_runtime.jsx)("p",{children:"検索中..."})}):(0,jsx_runtime.jsx)("div",{children:results.length>0?(0,jsx_runtime.jsxs)("div",{children:[(0,jsx_runtime.jsxs)("p",{className:"mb-4",children:[results.length,"件の検索結果"]}),(0,jsx_runtime.jsx)("div",{className:"space-y-6",children:results.map(((result,index)=>(0,jsx_runtime.jsxs)("div",{className:"border-b pb-4",children:[(0,jsx_runtime.jsx)("h3",{className:"text-xl font-semibold mb-2",children:(0,jsx_runtime.jsx)("a",{href:result.url,className:"hover:underline",style:{color:"var(--accent-primary)"},children:result.meta.title||"タイトルなし"})}),result.excerpt&&(0,jsx_runtime.jsx)("div",{style:{color:"var(--muted)"},dangerouslySetInnerHTML:{__html:result.excerpt}}),(0,jsx_runtime.jsx)("p",{className:"text-sm mt-1",style:{color:"var(--muted-secondary)"},children:(0,jsx_runtime.jsx)("a",{href:result.url,className:"hover:underline",children:result.url})})]},index)))})]}):query&&!isLoading?(0,jsx_runtime.jsx)("p",{children:"検索結果が見つかりませんでした。別のキーワードをお試しください。"}):null}):(0,jsx_runtime.jsx)("div",{className:"py-4",children:(0,jsx_runtime.jsx)("p",{children:"検索エンジンを読み込み中..."})})]})}SearchComponent.__docgenInfo={description:"",methods:[],displayName:"SearchComponent"};var app_router_context_shared_runtime=__webpack_require__("./node_modules/next/dist/shared/lib/app-router-context.shared-runtime.js");const mockRouter={push:()=>{},replace:()=>{},prefetch:()=>Promise.resolve(),back:()=>{},forward:()=>{},refresh:()=>{},pathname:"/search",route:"/search",query:{},params:{},basePath:"",asPath:"/search",isLocaleDomain:!1,isPreview:!1},SearchComponent_stories={title:"Components/Search/SearchComponent",component:SearchComponent,decorators:[Story=>(0,jsx_runtime.jsx)(app_router_context_shared_runtime.AppRouterContext.Provider,{value:mockRouter,children:(0,jsx_runtime.jsx)(Story,{})})]},Default={args:{}},__namedExportsOrder=["Default"]}}]);